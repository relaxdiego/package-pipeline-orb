description: >
  Builds and test an orb.

# The circleci-cli orb is declared in src/@orb.yml
executor: circleci-cli/default

parameters:
  orb-repo:
    description: >
      The name or URL of the orb repo
    type: string

  versioning-provider:
    description: Which versioning scheme to use when naming the package.
    type: enum
    enum:
      - semver2
    default: semver2

steps:
  - run:
      name: Print debug info
      command: |
        echo "
        orb-repo           : << parameters.orb-repo >>
        versioning-provider: << parameters.versioning-provider >>
        "

  - checkout

  - run:
      name: Render BUILD-INFO
      environment:
        PIPELINE_VERSIONING_PROVIDER: << parameters.versioning-provider >>
      command: <<include(scripts/render-build-info.sh)>>

  - run:
      name: Build and test
      environment:
        PIPELINE_PACKAGE_TYPE: circleci-orb
      command: <<include(scripts/build-and-test.sh)>>

  - persist_to_workspace:
      root: .
      paths:
        - BUILD-INFO
        - orb.yml
